# æ¼¸é€²å¼æ¶æ§‹æ”¹å–„è¨ˆåŠƒ

## ğŸ¯ ç›®æ¨™
è§£æ±ºã€Œä¿® A å£ Bã€çš„å•é¡Œï¼Œæ¡ç”¨æ¼¸é€²å¼æ”¹å–„æ–¹å¼ï¼Œç¢ºä¿ç¾æœ‰åŠŸèƒ½æ­£å¸¸é‹ä½œã€‚

## ğŸ“‹ æ”¹å–„éšæ®µ

### éšæ®µ 1ï¼šçµ±ä¸€éŒ¯èª¤è™•ç† (å„ªå…ˆç´šï¼šé«˜)
**å•é¡Œ**ï¼šå„é é¢ç¨ç«‹è™•ç†éŒ¯èª¤ï¼Œæ²’æœ‰çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- å‰µå»ºçµ±ä¸€çš„éŒ¯èª¤è™•ç† Hook
- çµ±ä¸€ Toast é€šçŸ¥ç³»çµ±
- æ·»åŠ éŒ¯èª¤é‚Šç•Œçµ„ä»¶

### éšæ®µ 2ï¼šæ”¹å–„è³‡æ–™åŒæ­¥ (å„ªå…ˆç´šï¼šé«˜)
**å•é¡Œ**ï¼šå„é é¢ç¨ç«‹ç®¡ç†ç‹€æ…‹ï¼Œå®¹æ˜“ä¸åŒæ­¥
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æ”¹å–„ç¾æœ‰ Hooks çš„è³‡æ–™åŒæ­¥
- æ·»åŠ è³‡æ–™å¤±æ•ˆæ©Ÿåˆ¶
- çµ±ä¸€ API å‘¼å«æ–¹å¼

### éšæ®µ 3ï¼šå„ªåŒ–ç‹€æ…‹ç®¡ç† (å„ªå…ˆç´šï¼šä¸­)
**å•é¡Œ**ï¼šç‹€æ…‹æ•£ä½ˆåœ¨å„å€‹çµ„ä»¶ä¸­
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- é›†ä¸­åŒ–ç‹€æ…‹ç®¡ç†
- æ·»åŠ ç‹€æ…‹å¿«å–
- æ”¹å–„ç‹€æ…‹æ›´æ–°é‚è¼¯

### éšæ®µ 4ï¼šé‡æ§‹çµ„ä»¶æ¶æ§‹ (å„ªå…ˆç´šï¼šä½)
**å•é¡Œ**ï¼šçµ„ä»¶è·è²¬ä¸æ¸…ï¼Œè€¦åˆåº¦é«˜
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- åˆ†é›¢å®¹å™¨çµ„ä»¶å’Œå±•ç¤ºçµ„ä»¶
- çµ±ä¸€çµ„ä»¶ä»‹é¢
- æ”¹å–„çµ„ä»¶è¤‡ç”¨æ€§

## ğŸš€ å¯¦æ–½æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šçµ±ä¸€éŒ¯èª¤è™•ç†
1. å‰µå»º `useErrorHandler` Hook
2. å‰µå»º `ErrorBoundary` çµ„ä»¶
3. çµ±ä¸€ Toast é€šçŸ¥ç³»çµ±
4. åœ¨å„é é¢ä¸­æ‡‰ç”¨

### æ­¥é©Ÿ 2ï¼šæ”¹å–„è³‡æ–™åŒæ­¥
1. åˆ†æç¾æœ‰ Hooks çš„è³‡æ–™æµ
2. æ·»åŠ è³‡æ–™å¤±æ•ˆæ©Ÿåˆ¶
3. çµ±ä¸€ API å‘¼å«æ–¹å¼
4. æ¸¬è©¦è³‡æ–™åŒæ­¥æ•ˆæœ

### æ­¥é©Ÿ 3ï¼šå„ªåŒ–ç‹€æ…‹ç®¡ç†
1. è­˜åˆ¥é‡è¤‡çš„ç‹€æ…‹é‚è¼¯
2. å‰µå»ºå…±ç”¨çš„ç‹€æ…‹ç®¡ç† Hook
3. æ·»åŠ ç‹€æ…‹å¿«å–æ©Ÿåˆ¶
4. æ¸¬è©¦ç‹€æ…‹ä¸€è‡´æ€§

### æ­¥é©Ÿ 4ï¼šé‡æ§‹çµ„ä»¶æ¶æ§‹
1. åˆ†é›¢å®¹å™¨çµ„ä»¶å’Œå±•ç¤ºçµ„ä»¶
2. çµ±ä¸€çµ„ä»¶ä»‹é¢
3. æ”¹å–„çµ„ä»¶è¤‡ç”¨æ€§
4. æ¸¬è©¦çµ„ä»¶åŠŸèƒ½

## ğŸ“Š æˆåŠŸæŒ‡æ¨™

### éšæ®µ 1 æˆåŠŸæŒ‡æ¨™
- [ ] çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- [ ] ä¸€è‡´çš„ Toast é€šçŸ¥
- [ ] éŒ¯èª¤é‚Šç•Œæ­£å¸¸å·¥ä½œ
- [ ] éŒ¯èª¤ä¸æœƒå½±éŸ¿å…¶ä»–é é¢

### éšæ®µ 2 æˆåŠŸæŒ‡æ¨™
- [ ] è³‡æ–™åŒæ­¥æ­£å¸¸
- [ ] API å‘¼å«çµ±ä¸€
- [ ] è³‡æ–™å¤±æ•ˆæ©Ÿåˆ¶æ­£å¸¸
- [ ] è·¨é é¢è³‡æ–™ä¸€è‡´æ€§

### éšæ®µ 3 æˆåŠŸæŒ‡æ¨™
- [ ] ç‹€æ…‹ç®¡ç†é›†ä¸­åŒ–
- [ ] ç‹€æ…‹å¿«å–æ­£å¸¸
- [ ] ç‹€æ…‹æ›´æ–°é‚è¼¯æ¸…æ™°
- [ ] æ€§èƒ½æå‡æ˜é¡¯

### éšæ®µ 4 æˆåŠŸæŒ‡æ¨™
- [ ] çµ„ä»¶è·è²¬æ¸…æ™°
- [ ] çµ„ä»¶è¤‡ç”¨æ€§æå‡
- [ ] çµ„ä»¶ä»‹é¢çµ±ä¸€
- [ ] ç¶­è­·æ€§æå‡

## ğŸ”§ æŠ€è¡“æ–¹æ¡ˆ

### çµ±ä¸€éŒ¯èª¤è™•ç†
```typescript
// useErrorHandler Hook
export const useErrorHandler = () => {
  const [error, setError] = useState<string | null>(null)
  const [snackbar, setSnackbar] = useState<SnackbarState>({
    open: false,
    message: '',
    severity: 'error'
  })

  const handleError = (error: any) => {
    const message = error.message || 'ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤'
    setError(message)
    setSnackbar({
      open: true,
      message,
      severity: 'error'
    })
  }

  const clearError = () => {
    setError(null)
    setSnackbar(prev => ({ ...prev, open: false }))
  }

  return { error, snackbar, handleError, clearError }
}
```

### æ”¹å–„è³‡æ–™åŒæ­¥
```typescript
// æ”¹å–„ç¾æœ‰ Hook
export const useStores = (params = {}) => {
  const [stores, setStores] = useState<Store[]>([])
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const fetchStores = useCallback(async () => {
    setLoading(true)
    setError(null)
    
    try {
      const data = await storesAPI.getStores(params)
      setStores(data.items || data)
    } catch (err: any) {
      setError(err.message)
      throw err // é‡æ–°æ‹‹å‡ºéŒ¯èª¤ä¾›ä¸Šå±¤è™•ç†
    } finally {
      setLoading(false)
    }
  }, [params.bounds, params.q, params.tags])

  // æ·»åŠ è³‡æ–™å¤±æ•ˆæ©Ÿåˆ¶
  const invalidateStores = useCallback(() => {
    fetchStores()
  }, [fetchStores])

  return {
    stores,
    loading,
    error,
    refetch: fetchStores,
    invalidate: invalidateStores
  }
}
```

### ç‹€æ…‹ç®¡ç†å„ªåŒ–
```typescript
// å…±ç”¨çš„ç‹€æ…‹ç®¡ç†
export const useAppState = () => {
  const [globalError, setGlobalError] = useState<string | null>(null)
  const [isOnline, setIsOnline] = useState(navigator.onLine)

  useEffect(() => {
    const handleOnline = () => setIsOnline(true)
    const handleOffline = () => setIsOnline(false)

    window.addEventListener('online', handleOnline)
    window.addEventListener('offline', handleOffline)

    return () => {
      window.removeEventListener('online', handleOnline)
      window.removeEventListener('offline', handleOffline)
    }
  }, [])

  return {
    globalError,
    setGlobalError,
    isOnline
  }
}
```

## ğŸ“ˆ é æœŸæ•ˆæœ

### çŸ­æœŸæ•ˆæœ (1-2 é€±)
- éŒ¯èª¤è™•ç†çµ±ä¸€åŒ–
- è³‡æ–™åŒæ­¥æ”¹å–„
- é–‹ç™¼é«”é©—æå‡

### ä¸­æœŸæ•ˆæœ (1 å€‹æœˆ)
- ç‹€æ…‹ç®¡ç†å„ªåŒ–
- æ€§èƒ½æå‡
- ç¶­è­·æ€§æ”¹å–„

### é•·æœŸæ•ˆæœ (2-3 å€‹æœˆ)
- æ¶æ§‹æ¸…æ™°åŒ–
- çµ„ä»¶è¤‡ç”¨æ€§æå‡
- é–‹ç™¼æ•ˆç‡æå‡

## ğŸ‰ ç¸½çµ

æ¼¸é€²å¼æ”¹å–„çš„å„ªå‹¢ï¼š
1. **é¢¨éšªä½**ï¼šæ¯æ¬¡åªæ”¹å–„ä¸€å€‹æ–¹é¢ï¼Œä¸æœƒç ´å£ç¾æœ‰åŠŸèƒ½
2. **å¯æ¸¬è©¦**ï¼šæ¯å€‹éšæ®µéƒ½å¯ä»¥ç¨ç«‹æ¸¬è©¦
3. **å¯å›æ»¾**ï¼šå¦‚æœå‡ºç¾å•é¡Œï¼Œå¯ä»¥å¿«é€Ÿå›æ»¾
4. **æŒçºŒæ”¹å–„**ï¼šå¯ä»¥æ ¹æ“šå¯¦éš›æƒ…æ³èª¿æ•´æ”¹å–„è¨ˆåŠƒ

é€™å€‹è¨ˆåŠƒå°‡å¹«åŠ©æˆ‘å€‘é€æ­¥è§£æ±ºã€Œä¿® A å£ Bã€çš„å•é¡Œï¼ŒåŒæ™‚ä¿æŒç³»çµ±çš„ç©©å®šæ€§ã€‚
